import{j as l}from"./index-90b88281.js";import{r as e,M as i,S as o,L as t,b as a}from"./mapbox-7de284f4.js";const n=e.forwardRef(({activeEvent:n=null,onEventClick:d=()=>{},mapState:r=null,currentStep:s=0,mapStyle:u="mapbox://styles/mapbox/satellite-streets-v12"},c)=>{var v,p,f,y,h,m,g,x,b,j,S,w,k,I,D,B,E,P,R,N,_,z,C,H,M,Z,L,A,W,J,K,X,Q,T,q,G,O,U,Y,F,V,$,ll,el,il,ol,tl,al,nl,dl,rl,sl,ul,cl,vl,pl,fl,yl,hl,ml,gl,xl,bl,jl,Sl,wl,kl,Il,Dl,Bl,El,Pl,Rl,Nl,_l,zl,Cl,Hl,Ml,Zl,Ll,Al,Wl,Jl,Kl,Xl,Ql,Tl,ql;e.useEffect(()=>{},[r]);const[Gl,Ol]=e.useState({longitude:115.2126,latitude:-8.6705,zoom:12}),[Ul,Yl]=e.useState(null),[Fl,Vl]=e.useState(null),[$l,le]=e.useState(null),[ee,ie]=e.useState(null),[oe,te]=e.useState(null),[ae,ne]=e.useState(null);e.useState(null);const[de,re]=e.useState(null),[se,ue]=e.useState(null),[ce,ve]=e.useState(!1),pe=e.useRef(null),fe="undefined"!=typeof window&&(window.innerWidth<768||/iPhone|iPad|iPod|Android/i.test(navigator.userAgent));return e.useEffect(()=>{const l=l=>{l.preventDefault(),ve(!0),setTimeout(()=>{ve(!1),window.location.reload()},2e3)},e=document.querySelector(".mapboxgl-canvas");if(e)return e.addEventListener("webglcontextlost",l,!1),()=>e.removeEventListener("webglcontextlost",l)},[]),e.useEffect(()=>{(async()=>{try{const l=await fetch("/data/flood_points.geojson"),e=await l.json();Yl(e);const i=await fetch("/data/flood_impact.geojson"),o=await i.json();Vl(o);const t=await fetch("/data/rivers.geojson"),a=await t.json();le(a);const n=await fetch("/data/admin_boundaries.geojson"),d=await n.json();ie(d);const r=await fetch("/data/radius.geojson"),s=await r.json();te(s);const u=await fetch("/data/river_buffers.geojson"),c=await u.json();ne(c);const v=await fetch("/data/population.geojson"),p=await v.json();re(p);const f=await fetch("/data/kelurahan_boundaries.geojson"),y=await f.json();ue(y)}catch(l){}})()},[]),e.useEffect(()=>{r&&r.center&&Ol(l=>({...l,longitude:r.center[0],latitude:r.center[1],zoom:r.zoom,pitch:r.pitch||0,bearing:r.bearing||0,transitionDuration:1500}))},[r]),e.useEffect(()=>{n&&n.coordinates&&Ol(l=>({...l,longitude:n.coordinates[0],latitude:n.coordinates[1],zoom:14,transitionDuration:1e3}))},[n]),ce?l.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-900 text-white",children:l.jsxs("div",{className:"text-center p-6",children:[l.jsx("div",{className:"text-xl font-bold mb-2",children:"Recovering map..."}),l.jsx("div",{className:"text-sm text-gray-400",children:"Please wait"})]})}):l.jsx("div",{className:"w-full h-full relative",children:l.jsxs(i,{ref:c,...Gl,onLoad:l=>{pe.current=l.target,fe&&l.target&&l.target.setMaxPitch(30)},mapboxAccessToken:"pk.eyJ1IjoibW9vaG9uaWppbiIsImEiOiJjbWZtZ3hpeXUwMXQzMmpzaHBybDRvbXhhIn0.JEnQgjDxYdyAuo-24p8DZg",mapStyle:(null==r?void 0:r.mapStyle)||u,onMove:l=>Ol(l.viewState),maxPitch:fe?30:85,maxZoom:fe?16:22,antialias:!fe,preserveDrawingBuffer:!1,onClick:l=>{var e;const i=null==(e=l.features)?void 0:e[0];i&&i.properties&&d(i.properties)},scrollZoom:!1!==(null==r?void 0:r.interactive),dragPan:!1!==(null==r?void 0:r.interactive),dragRotate:!1!==(null==r?void 0:r.interactive),doubleClickZoom:!1!==(null==r?void 0:r.interactive),touchZoomRotate:!1!==(null==r?void 0:r.interactive),terrain:(null==(v=null==r?void 0:r.layers)?void 0:v.terrain)?{source:"mapbox-terrain",exaggeration:(null==(f=null==(p=null==r?void 0:r.layerStyles)?void 0:p.terrain)?void 0:f.exaggeration)||1.5}:void 0,children:[l.jsx(o,{id:"mapbox-terrain",type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1"}),((null==(y=null==r?void 0:r.layers)?void 0:y.hillshade)??!1)&&l.jsx(t,{id:"hillshade",type:"hillshade",source:"mapbox-terrain",paint:{"hillshade-illumination-direction":315,"hillshade-exaggeration":(null==(m=null==(h=null==r?void 0:r.layerStyles)?void 0:h.hillshade)?void 0:m.exaggeration)||.5}}),ee&&((null==(g=null==r?void 0:r.layers)?void 0:g.adminBoundaries)??!0)&&l.jsxs(o,{id:"admin-boundaries",type:"geojson",data:ee,children:[l.jsx(t,{id:"admin-boundaries-fill",type:"fill",paint:{"fill-color":"#ffffff","fill-opacity":.1}}),l.jsx(t,{id:"admin-boundaries-line",type:"line",paint:{"line-color":(null==(b=null==(x=null==r?void 0:r.layerStyles)?void 0:x.adminBoundaries)?void 0:b.color)||"#000000","line-width":(null==(S=null==(j=null==r?void 0:r.layerStyles)?void 0:j.adminBoundaries)?void 0:S.width)||2,"line-opacity":(null==(k=null==(w=null==r?void 0:r.layerStyles)?void 0:w.adminBoundaries)?void 0:k.opacity)||.5}})]}),$l&&((null==(I=null==r?void 0:r.layers)?void 0:I.rivers)??!1)&&l.jsxs(o,{id:"rivers",type:"geojson",data:$l,children:[((null==(D=null==r?void 0:r.layers)?void 0:D.riverBuffer)??!1)&&l.jsx(t,{id:"rivers-buffer",type:"line",paint:{"line-color":"#3b82f6","line-width":12,"line-opacity":.3,"line-blur":2}}),l.jsx(t,{id:"rivers-line",type:"line",paint:{"line-color":(null==(E=null==(B=null==r?void 0:r.layerStyles)?void 0:B.rivers)?void 0:E.color)||"#1d4ed8","line-width":(null==(R=null==(P=null==r?void 0:r.layerStyles)?void 0:P.rivers)?void 0:R.width)||10,"line-opacity":(null==(_=null==(N=null==r?void 0:r.layerStyles)?void 0:N.rivers)?void 0:_.opacity)||.9}})]}),Fl&&((null==(z=null==r?void 0:r.layers)?void 0:z.floodImpact)??!1)&&l.jsx(o,{id:"flood-impact",type:"geojson",data:Fl,children:l.jsx(t,{id:"flood-impact-fill",type:"fill",paint:{"fill-color":(null==(H=null==(C=null==r?void 0:r.layerStyles)?void 0:C.floodImpact)?void 0:H.colorByDepth)?["match",["get","Ketinggian"],"tinggi",r.layerStyles.floodImpact.colors.high,"sedang",r.layerStyles.floodImpact.colors.medium,"rendah",r.layerStyles.floodImpact.colors.low,r.layerStyles.floodImpact.colors.low]:(null==(Z=null==(M=null==r?void 0:r.layerStyles)?void 0:M.floodImpact)?void 0:Z.color)||"#CC9900","fill-opacity":(null==(A=null==(L=null==r?void 0:r.layerStyles)?void 0:L.floodImpact)?void 0:A.opacity)||.2,"fill-outline-color":"#ffffff"}})}),oe&&((null==(W=null==r?void 0:r.layers)?void 0:W.floodRadius)??!1)&&l.jsxs(o,{id:"flood-radius",type:"geojson",data:oe,children:[l.jsx(t,{id:"flood-radius-fill",type:"fill",paint:{"fill-color":(null==(K=null==(J=null==r?void 0:r.layerStyles)?void 0:J.floodRadius)?void 0:K.color)||"#f59e0b","fill-opacity":(null==(Q=null==(X=null==r?void 0:r.layerStyles)?void 0:X.floodRadius)?void 0:Q.opacity)||.3,"fill-outline-color":"#f59e0b"}}),l.jsx(t,{id:"flood-radius-line",type:"line",paint:{"line-color":"#f59e0b","line-width":1,"line-opacity":.5}})]}),Ul&&((null==(T=null==r?void 0:r.layers)?void 0:T.floodHeatmap)??!1)&&l.jsx(o,{id:"flood-heatmap",type:"geojson",data:Ul,children:l.jsx(t,{id:"flood-heatmap-layer",type:"heatmap",filter:(null==(G=null==(q=null==r?void 0:r.layerStyles)?void 0:q.floodHeatmap)?void 0:G.filter)||null,paint:{"heatmap-weight":(null==(U=null==(O=null==r?void 0:r.layerStyles)?void 0:O.floodHeatmap)?void 0:U.weight)||1,"heatmap-intensity":(null==(F=null==(Y=null==r?void 0:r.layerStyles)?void 0:Y.floodHeatmap)?void 0:F.intensity)||1,"heatmap-color":(null==($=null==(V=null==r?void 0:r.layerStyles)?void 0:V.floodHeatmap)?void 0:$.color)||["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":(null==(el=null==(ll=null==r?void 0:r.layerStyles)?void 0:ll.floodHeatmap)?void 0:el.radius)||20,"heatmap-opacity":(null==(ol=null==(il=null==r?void 0:r.layerStyles)?void 0:il.floodHeatmap)?void 0:ol.opacity)||.8}})}),((null==(tl=null==r?void 0:r.layers)?void 0:tl.buildings)??!1)&&!(null==(al=null==r?void 0:r.layers)?void 0:al.buildings3D)&&l.jsx(o,{id:"mapbox-buildings",type:"vector",url:"mapbox://mapbox.mapbox-streets-v8",children:l.jsx(t,{id:"building-footprints","source-layer":"building",type:"fill",paint:{"fill-color":(null==(dl=null==(nl=null==r?void 0:r.layerStyles)?void 0:nl.buildings)?void 0:dl.color)||"#d1d5db","fill-opacity":(null==(sl=null==(rl=null==r?void 0:r.layerStyles)?void 0:rl.buildings)?void 0:sl.opacity)||.7,"fill-outline-color":(null==(cl=null==(ul=null==r?void 0:r.layerStyles)?void 0:ul.buildings)?void 0:cl.outlineColor)||"#9ca3af"}})}),((null==(vl=null==r?void 0:r.layers)?void 0:vl.buildings3D)??!1)&&l.jsx(o,{id:"mapbox-buildings-3d",type:"vector",url:"mapbox://mapbox.mapbox-streets-v8",children:l.jsx(t,{id:"building-3d","source-layer":"building",type:"fill-extrusion",paint:{"fill-extrusion-color":(null==(fl=null==(pl=null==r?void 0:r.layerStyles)?void 0:pl.buildings3D)?void 0:fl.color)||["case",["has","height"],"#aaa","#ddd"],"fill-extrusion-height":["case",["has","height"],["get","height"],["*",["get","levels"],3]],"fill-extrusion-base":0,"fill-extrusion-opacity":(null==(hl=null==(yl=null==r?void 0:r.layerStyles)?void 0:yl.buildings3D)?void 0:hl.opacity)||.8}})}),ae&&((null==(ml=null==r?void 0:r.layers)?void 0:ml.riverBuffers)??!1)&&l.jsxs(o,{id:"river-buffers",type:"geojson",data:ae,children:[l.jsx(t,{id:"river-buffers-fill",type:"fill",paint:{"fill-color":["match",["get","distance"],10,(null==(bl=null==(xl=null==(gl=null==r?void 0:r.layerStyles)?void 0:gl.riverBuffers)?void 0:xl.colors)?void 0:bl["10m"])||"#93c5fd",50,(null==(wl=null==(Sl=null==(jl=null==r?void 0:r.layerStyles)?void 0:jl.riverBuffers)?void 0:Sl.colors)?void 0:wl["50m"])||"#60a5fa",100,(null==(Dl=null==(Il=null==(kl=null==r?void 0:r.layerStyles)?void 0:kl.riverBuffers)?void 0:Il.colors)?void 0:Dl["100m"])||"#3b82f6","#93c5fd"],"fill-opacity":(null==(El=null==(Bl=null==r?void 0:r.layerStyles)?void 0:Bl.riverBuffers)?void 0:El.opacity)||.3}}),l.jsx(t,{id:"river-buffers-line",type:"line",paint:{"line-color":"#2563eb","line-width":1,"line-opacity":.4}})]}),se&&((null==(Pl=null==r?void 0:r.layers)?void 0:Pl.populationChoropleth)??!1)&&l.jsxs(o,{id:"population-choropleth",type:"geojson",data:se,children:[l.jsx(t,{id:"population-choropleth-fill",type:"fill",paint:{"fill-color":["interpolate",["linear"],["get","jumlah_penduduk"],5e3,"#fef3c7",1e4,"#fde68a",15e3,"#fcd34d",2e4,"#fbbf24",25e3,"#f59e0b",3e4,"#d97706",35e3,"#b45309"],"fill-opacity":(null==(Nl=null==(Rl=null==r?void 0:r.layerStyles)?void 0:Rl.populationChoropleth)?void 0:Nl.opacity)||.7}}),l.jsx(t,{id:"population-choropleth-outline",type:"line",paint:{"line-color":"#ffffff","line-width":1,"line-opacity":.5}})]}),se&&((null==(_l=null==r?void 0:r.layers)?void 0:_l.population3D)??!1)&&l.jsx(o,{id:"population-3d",type:"geojson",data:se,children:l.jsx(t,{id:"population-3d-extrusion",type:"fill-extrusion",paint:{"fill-extrusion-color":["interpolate",["linear"],["get","jumlah_penduduk"],5e3,"#e9d5ff",1e4,"#d8b4fe",15e3,"#c084fc",2e4,"#a855f7",25e3,"#9333ea",3e4,"#7e22ce",35e3,"#6b21a8"],"fill-extrusion-height":["*",["get","jumlah_penduduk"],(null==(Cl=null==(zl=null==r?void 0:r.layerStyles)?void 0:zl.population3D)?void 0:Cl.heightMultiplier)||2],"fill-extrusion-base":0,"fill-extrusion-opacity":(null==(Ml=null==(Hl=null==r?void 0:r.layerStyles)?void 0:Hl.population3D)?void 0:Ml.opacity)||.7}})}),((null==(Zl=null==r?void 0:r.layers)?void 0:Zl.inariskLayer)??!1)&&l.jsx(o,{id:"inarisk-layer",type:"raster",tiles:["https://gis.bnpb.go.id/server/rest/services/inarisk/layer_risiko_banjir/ImageServer/exportImage?bbox={bbox-epsg-3857}&bboxSR=3857&size=256,256&imageSR=3857&format=png&transparent=true&f=image"],tileSize:256,children:l.jsx(t,{id:"inarisk-raster",type:"raster",paint:{"raster-opacity":(null==(Al=null==(Ll=null==r?void 0:r.layerStyles)?void 0:Ll.inariskLayer)?void 0:Al.opacity)||.6,"raster-fade-duration":300}})}),Ul&&((null==(Wl=null==r?void 0:r.layers)?void 0:Wl.floodPoints)??!0)&&l.jsx(o,{id:"flood-points",type:"geojson",data:Ul,children:l.jsx(t,{id:"flood-points-circle",type:"circle",paint:{"circle-radius":(null==(Kl=null==(Jl=null==r?void 0:r.layerStyles)?void 0:Jl.floodPoints)?void 0:Kl.size)||["match",["get","Ketinggian"],"tinggi",8,"sedang",6,"rendah",4,5],"circle-color":(null==(Ql=null==(Xl=null==r?void 0:r.layerStyles)?void 0:Xl.floodPoints)?void 0:Ql.color)||["match",["get","Ketinggian"],"tinggi","#dc2626","sedang","#ea580c","rendah","#65a30d","#6b7280"],"circle-stroke-color":"#ffffff","circle-stroke-width":2,"circle-opacity":(null==(ql=null==(Tl=null==r?void 0:r.layerStyles)?void 0:Tl.floodPoints)?void 0:ql.opacity)||.8}})}),(null==r?void 0:r.marker)&&l.jsx(a,{longitude:r.marker.coordinates[0],latitude:r.marker.coordinates[1],anchor:"bottom",children:l.jsxs("div",{className:"flex flex-col items-center",children:[l.jsx("div",{className:"bg-red-600 text-white px-3 py-1 rounded-lg shadow-lg text-sm font-semibold mb-1 whitespace-nowrap",children:r.marker.title}),l.jsx("div",{className:"w-6 h-6 bg-red-600 rounded-full border-4 border-white shadow-lg flex items-center justify-center",children:l.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})})]})})});n.displayName="InteractiveMap";const d=e.memo(n);export{d as I};
